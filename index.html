<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ARæ‹ç…§äº­ - GitHub Pagesç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- ä½¿ç”¨CDNé“¾æ¥ï¼Œç¡®ä¿ç¨³å®š -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/ar.js@3.4.0/aframe/build/aframe-ar.js"></script>
  
  <style>
    /* æç®€é£æ ¼ï¼Œç¡®ä¿å…¼å®¹æ€§ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      color: white;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }
    
    /* å¯åŠ¨å±å¹• */
    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      text-align: center;
      padding: 20px;
    }
    
    .logo {
      font-size: 100px;
      margin-bottom: 30px;
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    h1 {
      font-size: 48px;
      font-weight: 900;
      margin-bottom: 20px;
      text-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .subtitle {
      font-size: 20px;
      opacity: 0.9;
      margin-bottom: 40px;
      max-width: 500px;
    }
    
    .features {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 30px 0;
      max-width: 600px;
    }
    
    .feature {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px 25px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #startBtn {
      background: linear-gradient(45deg, #FF416C, #FF4B2B);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 25px 70px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 40px;
      box-shadow: 0 15px 35px rgba(255,65,108,0.4);
      transition: all 0.3s;
    }
    
    #startBtn:active {
      transform: scale(0.95);
    }
    
    .github-badge {
      position: absolute;
      bottom: 30px;
      background: rgba(255,255,255,0.1);
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    /* ARåœºæ™¯ */
    #arContainer {
      display: none;
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    /* æ§åˆ¶æ  */
    .controls {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 100;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 90%;
    }
    
    .btn {
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 15px 25px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 140px;
      justify-content: center;
    }
    
    .btn:active {
      background: rgba(255,255,255,0.2);
    }
    
    .photo-btn {
      background: linear-gradient(45deg, #FF416C, #FF4B2B);
      font-weight: bold;
    }
    
    /* åœºæ™¯æŒ‡ç¤ºå™¨ */
    .scene-indicator {
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 15px 30px;
      color: white;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 100;
    }
    
    /* æ‹ç…§é¢„è§ˆ */
    #preview {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    #previewImg {
      max-width: 90%;
      max-height: 70%;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      margin-bottom: 40px;
    }
    
    .preview-btns {
      display: flex;
      gap: 20px;
    }
    
    .preview-btn {
      padding: 15px 40px;
      border-radius: 15px;
      border: none;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      color: white;
    }
    
    #saveBtn {
      background: linear-gradient(45deg, #4CAF50, #2E7D32);
    }
    
    #closePreview {
      background: linear-gradient(45deg, #f44336, #c62828);
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .loader {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2000;
      text-align: center;
      color: white;
    }
    
    .spinner {
      width: 80px;
      height: 80px;
      border: 6px solid rgba(255,255,255,0.3);
      border-top-color: #FF416C;
      border-radius: 50%;
      margin: 0 auto 20px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* é”™è¯¯æç¤º */
    #error {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(244, 67, 54, 0.9);
      color: white;
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      z-index: 3000;
      max-width: 400px;
      backdrop-filter: blur(20px);
    }
    
    /* æ•™ç¨‹æç¤º */
    .tutorial {
      position: absolute;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 20px 30px;
      border-radius: 15px;
      font-size: 16px;
      text-align: center;
      z-index: 90;
      backdrop-filter: blur(10px);
      max-width: 90%;
    }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
      h1 { font-size: 36px; }
      .subtitle { font-size: 16px; }
      .feature { font-size: 16px; padding: 12px 20px; }
      #startBtn { padding: 20px 50px; font-size: 24px; }
      .btn { min-width: 120px; padding: 12px 20px; font-size: 14px; }
      .scene-indicator { font-size: 16px; padding: 12px 25px; }
    }
  </style>
</head>
<body>
  <!-- å¯åŠ¨å±å¹• -->
  <div id="splash">
    <div class="logo">ğŸ¬</div>
    <h1>AR æ‹ç…§äº­</h1>
    <p class="subtitle">æ— éœ€å®‰è£…ï¼Œæ— éœ€é…ç½®ï¼Œæ‰“å¼€å³ç”¨</p>
    
    <div class="features">
      <div class="feature">ğŸ“± æ‰‹æœºç”µè„‘éƒ½èƒ½ç”¨</div>
      <div class="feature">ğŸš« ä¸éœ€è¦ ngrok</div>
      <div class="feature">ğŸ“¸ ä¸€é”®æ‹ç…§ä¿å­˜</div>
      <div class="feature">ğŸ¯ è¯†åˆ«ç¨³å®šå¿«é€Ÿ</div>
      <div class="feature">ğŸŒ GitHub Pages æ‰˜ç®¡</div>
      <div class="feature">ğŸ’¯ æ°¸ä¹…åœ¨çº¿</div>
    </div>
    
    <button id="startBtn" onclick="startAR()">
      ğŸš€ ç«‹å³ä½“éªŒ
    </button>
    
    <div class="github-badge">
      <span>â­</span>
      <span>GitHub Pages æ°¸ä¹…æ‰˜ç®¡ | 100% å…è´¹</span>
    </div>
  </div>
  
  <!-- åŠ è½½åŠ¨ç”» -->
  <div class="loader" id="loader">
    <div class="spinner"></div>
    <p id="loaderText">å‡†å¤‡ AR ç¯å¢ƒ...</p>
  </div>
  
  <!-- ARåœºæ™¯ -->
  <div id="arContainer">
    <!-- æ•™ç¨‹æç¤º -->
    <div class="tutorial" id="tutorial">
      å°†æ‘„åƒå¤´å¯¹å‡† Hiro æ ‡è®°å›¾æ¡ˆ<br>
      <small>æç¤ºï¼šè®¿é—® <a href="https://hiro.ar-js.org" style="color:#FF416C; text-decoration:none;">hiro.ar-js.org</a> æ‰“å°æ ‡è®°</small>
    </div>
    
    <!-- åœºæ™¯æŒ‡ç¤ºå™¨ -->
    <div class="scene-indicator">
      <span id="sceneIcon">ğŸ¶</span>
      <span id="sceneName">åŠ¨ç‰©åˆå½±</span>
    </div>
    
    <!-- æ§åˆ¶æ  -->
    <div class="controls">
      <button class="btn" onclick="switchScene()">
        <span>ğŸ”„</span>åˆ‡æ¢åœºæ™¯
      </button>
      <button class="btn" onclick="changeModel(-1)">
        <span>â¬…ï¸</span>ä¸Šä¸€ä¸ª
      </button>
      <button class="btn" onclick="changeModel(1)">
        <span>â¡ï¸</span>ä¸‹ä¸€ä¸ª
      </button>
      <button class="btn photo-btn" onclick="takePhoto()">
        <span>ğŸ“¸</span>æ‹ç…§
      </button>
    </div>
    
    <!-- A-Frame ARåœºæ™¯ -->
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
      renderer="antialias: true; alpha: true;"
    >
      <!-- å…‰ç…§ -->
      <a-light type="ambient" color="#FFFFFF" intensity="0.8"></a-light>
      <a-light type="directional" color="#FFFFFF" position="1 3 2" intensity="0.6"></a-light>
      
      <!-- æ ‡è®°è¯†åˆ« -->
      <a-marker preset="hiro">
        <!-- åœºæ™¯1ï¼šåŸºç¡€å½¢çŠ¶ -->
        <a-entity id="scene1">
          <!-- çº¢è‰²ç«‹æ–¹ä½“ -->
          <a-box id="cube" 
                color="#FF3B30" 
                width="0.2" 
                height="0.2" 
                depth="0.2" 
                position="-0.3 0.5 0"
                visible="true">
            <a-animation attribute="rotation"
                        dur="10000"
                        to="0 360 0"
                        repeat="indefinite"
                        easing="linear">
            </a-animation>
          </a-box>
          
          <!-- è“è‰²çƒä½“ -->
          <a-sphere id="sphere" 
                   color="#007AFF" 
                   radius="0.1" 
                   position="0 0.5 0"
                   visible="false">
            <a-animation attribute="position"
                        dur="2000"
                        from="0 0.5 0"
                        to="0 0.8 0"
                        direction="alternate"
                        repeat="indefinite"
                        easing="easeInOutSine">
            </a-animation>
          </a-sphere>
          
          <!-- ç»¿è‰²åœ†æŸ± -->
          <a-cylinder id="cylinder" 
                     color="#34C759" 
                     radius="0.1" 
                     height="0.3" 
                     position="0.3 0.5 0"
                     visible="false">
            <a-animation attribute="rotation"
                        dur="5000"
                        to="360 0 0"
                        repeat="indefinite"
                        easing="linear">
            </a-animation>
          </a-cylinder>
        </a-entity>
        
        <!-- åœºæ™¯2ï¼šç®€å•åœºæ™¯ -->
        <a-entity id="scene2" visible="false">
          <!-- åœ°é¢ -->
          <a-plane color="#5AC8FA" 
                  width="2" 
                  height="2" 
                  rotation="-90 0 0" 
                  position="0 0 0">
          </a-plane>
          
          <!-- ç®€å•å»ºç­‘ -->
          <a-box color="#FF9500" 
                width="0.3" 
                height="0.5" 
                depth="0.3" 
                position="-0.5 0.25 0">
          </a-box>
          
          <a-box color="#5856D6" 
                width="0.4" 
                height="0.3" 
                depth="0.4" 
                position="0.5 0.15 0">
          </a-box>
          
          <!-- äººç‰© -->
          <a-entity position="0 0.2 0.5">
            <a-sphere color="#FF2D55" radius="0.05" position="0 0.15 0"></a-sphere>
            <a-box color="#FF2D55" width="0.08" height="0.2" depth="0.08" position="0 -0.05 0"></a-box>
          </a-entity>
        </a-entity>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>
  </div>
  
  <!-- æ‹ç…§é¢„è§ˆ -->
  <div id="preview">
    <img id="previewImg" src="">
    <div class="preview-btns">
      <button class="preview-btn" id="saveBtn" onclick="savePhoto()">ğŸ’¾ ä¿å­˜å›¾ç‰‡</button>
      <button class="preview-btn" id="closePreview" onclick="closePreview()">âœ–ï¸ å…³é—­</button>
    </div>
  </div>
  
  <!-- é”™è¯¯æç¤º -->
  <div id="error">
    <h3 style="margin-bottom: 15px;">âš ï¸ æç¤º</h3>
    <p id="errorText"></p>
    <button onclick="location.reload()" 
            style="margin-top: 20px; padding: 12px 30px; background: white; color: #f44336; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;">
      åˆ·æ–°é¡µé¢
    </button>
  </div>
  
  <script>
    // ============== å…¨å±€å˜é‡ ==============
    let currentScene = 1; // 1æˆ–2
    let currentModel = 0; // 0,1,2
    let models = ['cube', 'sphere', 'cylinder'];
    let isARReady = false;
    
    // ============== é¡µé¢åˆå§‹åŒ– ==============
    document.addEventListener('DOMContentLoaded', function() {
      console.log('é¡µé¢åŠ è½½å®Œæˆ');
      
      // æ£€æŸ¥URLï¼Œå¦‚æœæ˜¯GitHub Pagesï¼Œæ˜¾ç¤ºæç¤º
      if (window.location.hostname.includes('github.io')) {
        console.log('GitHub Pages ç¯å¢ƒ');
        document.querySelector('.github-badge').innerHTML = 
          '<span>ğŸŒ</span><span>GitHub Pages æ‰˜ç®¡ | åœ¨çº¿ç‰ˆ</span>';
      }
      
      // æ£€æŸ¥è®¾å¤‡
      checkDevice();
    });
    
    function checkDevice() {
      const ua = navigator.userAgent;
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯iOS
      if (/iPhone|iPad|iPod/.test(ua)) {
        console.log('iOSè®¾å¤‡');
        // iOS Safariéœ€è¦ç‰¹æ®Šå¤„ç†
        document.getElementById('tutorial').innerHTML = 
          'iOSä½¿ç”¨æç¤ºï¼š<br>1. ç‚¹å‡»ä¸‹æ–¹"åˆ†äº«"æŒ‰é’®<br>2. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"<br>3. ä»ä¸»å±å¹•æ‰“å¼€ä½“éªŒæ›´ä½³';
      }
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯Safari
      if (/Safari/.test(ua) && !/Chrome/.test(ua)) {
        console.log('Safariæµè§ˆå™¨');
      }
    }
    
    // ============== å¼€å§‹ARä½“éªŒ ==============
    function startAR() {
      console.log('å¼€å§‹ARä½“éªŒ');
      
      // éšè—å¯åŠ¨é¡µ
      document.getElementById('splash').style.display = 'none';
      showLoader('æ­£åœ¨æ£€æŸ¥æ‘„åƒå¤´æƒé™...');
      
      // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½<br>è¯·ä½¿ç”¨æœ€æ–°ç‰ˆ Chrome æˆ– Safari');
        return;
      }
      
      // è¯·æ±‚æ‘„åƒå¤´æƒé™
      navigator.mediaDevices.getUserMedia({ 
        video: {
          facingMode: 'environment', // ä¼˜å…ˆä½¿ç”¨åç½®æ‘„åƒå¤´
          width: { ideal: 1280 },
          height: { ideal: 720 }
        },
        audio: false
      })
      .then(stream => {
        console.log('æ‘„åƒå¤´æƒé™å·²è·å¾—');
        // åœæ­¢æµï¼ŒA-Frameä¼šé‡æ–°è·å–
        stream.getTracks().forEach(track => track.stop());
        
        // åˆå§‹åŒ–ARåœºæ™¯
        initAR();
      })
      .catch(error => {
        console.error('æ‘„åƒå¤´é”™è¯¯:', error);
        hideLoader();
        
        let errorMsg = 'æ— æ³•è®¿é—®æ‘„åƒå¤´';
        if (error.name === 'NotAllowedError') {
          errorMsg = 'æ‘„åƒå¤´æƒé™è¢«æ‹’ç»<br>è¯·å…è®¸æµè§ˆå™¨è®¿é—®æ‘„åƒå¤´';
        } else if (error.name === 'NotFoundError') {
          errorMsg = 'æœªæ‰¾åˆ°æ‘„åƒå¤´è®¾å¤‡';
        } else if (error.name === 'NotSupportedError') {
          errorMsg = 'å½“å‰ç¯å¢ƒä¸æ”¯æŒæ‘„åƒå¤´';
        }
        
        showError(errorMsg);
      });
    }
    
    // ============== åˆå§‹åŒ–AR ==============
    function initAR() {
      showLoader('æ­£åœ¨åŠ è½½ARåœºæ™¯...');
      
      // æ˜¾ç¤ºARå®¹å™¨
      document.getElementById('arContainer').style.display = 'block';
      
      // è·å–A-Frameåœºæ™¯
      const scene = document.querySelector('a-scene');
      
      if (scene) {
        // ç›‘å¬åœºæ™¯åŠ è½½å®Œæˆ
        scene.addEventListener('loaded', function() {
          console.log('ARåœºæ™¯åŠ è½½å®Œæˆ');
          hideLoader();
          isARReady = true;
          
          // å‡ ç§’åéšè—æ•™ç¨‹
          setTimeout(() => {
            document.getElementById('tutorial').style.opacity = '0.5';
          }, 5000);
        });
        
        // é”™è¯¯å¤„ç†
        scene.addEventListener('error', function(e) {
          console.error('ARåœºæ™¯é”™è¯¯:', e.detail);
          hideLoader();
          showError('ARåœºæ™¯åŠ è½½å¤±è´¥<br>è¯·ç¡®ä¿æµè§ˆå™¨æ”¯æŒWebGL');
        });
        
        // AR.jsäº‹ä»¶
        scene.addEventListener('arjs-video-loaded', function() {
          console.log('ARè§†é¢‘æµå·²åŠ è½½');
        });
        
        scene.addEventListener('markerFound', function() {
          console.log('æ ‡è®°è¯†åˆ«æˆåŠŸ');
          document.getElementById('tutorial').style.display = 'none';
        });
        
        scene.addEventListener('markerLost', function() {
          console.log('æ ‡è®°ä¸¢å¤±');
          document.getElementById('tutorial').style.display = 'block';
        });
        
        // æ›´æ–°åœºæ™¯æŒ‡ç¤ºå™¨
        updateSceneIndicator();
      } else {
        hideLoader();
        showError('æ— æ³•åˆ›å»ºARåœºæ™¯');
      }
    }
    
    // ============== åœºæ™¯æ§åˆ¶ ==============
    function switchScene() {
      const scene1 = document.getElementById('scene1');
      const scene2 = document.getElementById('scene2');
      
      if (currentScene === 1) {
        // åˆ‡æ¢åˆ°åœºæ™¯2
        scene1.setAttribute('visible', 'false');
        scene2.setAttribute('visible', 'true');
        currentScene = 2;
      } else {
        // åˆ‡æ¢åˆ°åœºæ™¯1
        scene2.setAttribute('visible', 'false');
        scene1.setAttribute('visible', 'true');
        currentScene = 1;
        currentModel = 0;
        showCurrentModel();
      }
      
      updateSceneIndicator();
    }
    
    function updateSceneIndicator() {
      const icon = document.getElementById('sceneIcon');
      const name = document.getElementById('sceneName');
      
      if (currentScene === 1) {
        icon.textContent = 'ğŸ®';
        name.textContent = 'åŸºç¡€å½¢çŠ¶';
      } else {
        icon.textContent = 'ğŸ™ï¸';
        name.textContent = 'ç®€å•åœºæ™¯';
      }
    }
    
    // ============== æ¨¡å‹æ§åˆ¶ ==============
    function showCurrentModel() {
      if (currentScene !== 1) return;
      
      models.forEach((modelId, index) => {
        const model = document.getElementById(modelId);
        if (model) {
          model.setAttribute('visible', index === currentModel);
        }
      });
    }
    
    function changeModel(direction) {
      if (currentScene !== 1) return;
      
      currentModel = (currentModel + direction + models.length) % models.length;
      showCurrentModel();
    }
    
    // ============== æ‹ç…§åŠŸèƒ½ ==============
    function takePhoto() {
      if (!isARReady) {
        showError('ARåœºæ™¯æœªå°±ç»ª<br>è¯·ç­‰å¾…åŠ è½½å®Œæˆ');
        return;
      }
      
      console.log('æ‹ç…§ä¸­...');
      
      try {
        const scene = document.querySelector('a-scene');
        const canvas = document.querySelector('canvas');
        
        if (canvas && canvas.width > 100) {
          // åˆ›å»ºé«˜è´¨é‡æˆªå›¾
          const tempCanvas = document.createElement('canvas');
          tempCanvas.width = canvas.width;
          tempCanvas.height = canvas.height;
          const ctx = tempCanvas.getContext('2d');
          
          // ç™½è‰²èƒŒæ™¯
          ctx.fillStyle = '#FFFFFF';
          ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
          
          // ç»˜åˆ¶ARå†…å®¹
          ctx.drawImage(canvas, 0, 0);
          
          // æ·»åŠ æ°´å°
          ctx.fillStyle = 'rgba(0,0,0,0.3)';
          ctx.font = '20px Arial';
          ctx.fillText('AR Photo Booth', 20, tempCanvas.height - 20);
          
          // æ˜¾ç¤ºé¢„è§ˆ
          const dataURL = tempCanvas.toDataURL('image/png');
          document.getElementById('previewImg').src = dataURL;
          document.getElementById('preview').style.display = 'flex';
        } else {
          // å¤‡ç”¨æ–¹æ¡ˆï¼šæç¤ºç”¨æˆ·æˆªå›¾
          showError('æ— æ³•è·å–ç”»é¢<br>è¯·ä½¿ç”¨ç³»ç»Ÿæˆªå›¾åŠŸèƒ½ï¼š<br>1. åŒæ—¶æŒ‰ç”µæº+éŸ³é‡ä¸Šé”®<br>2. æˆ–æŒ‰Cmd+Shift+4ï¼ˆMacï¼‰');
        }
      } catch (error) {
        console.error('æ‹ç…§å¤±è´¥:', error);
        showError('æ‹ç…§åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨');
      }
    }
    
    function savePhoto() {
      const img = document.getElementById('previewImg');
      if (!img.src) return;
      
      try {
        const link = document.createElement('a');
        link.href = img.src;
        const date = new Date();
        const filename = `AR_Photo_${date.getFullYear()}${pad(date.getMonth()+1)}${pad(date.getDate())}_${pad(date.getHours())}${pad(date.getMinutes())}${pad(date.getSeconds())}.png`;
        link.download = filename;
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
        setTimeout(() => {
          alert('ç…§ç‰‡å·²å¼€å§‹ä¸‹è½½ï¼\nè¯·åœ¨ä¸‹è½½æ–‡ä»¶å¤¹ä¸­æŸ¥çœ‹ã€‚');
        }, 300);
      } catch (error) {
        console.error('ä¿å­˜å¤±è´¥:', error);
        alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é•¿æŒ‰å›¾ç‰‡é€‰æ‹©"ä¿å­˜å›¾åƒ"');
      }
    }
    
    function pad(num) {
      return num.toString().padStart(2, '0');
    }
    
    function closePreview() {
      document.getElementById('preview').style.display = 'none';
    }
    
    // ============== UIè¾…åŠ©å‡½æ•° ==============
    function showLoader(text) {
      document.getElementById('loaderText').textContent = text;
      document.getElementById('loader').style.display = 'block';
    }
    
    function hideLoader() {
      document.getElementById('loader').style.display = 'none';
    }
    
    function showError(html) {
      document.getElementById('errorText').innerHTML = html;
      document.getElementById('error').style.display = 'block';
    }
    
    // ============== Safariå…¼å®¹å¤„ç† ==============
    // é˜²æ­¢iOSæ©¡çš®ç­‹æ•ˆæœ
    document.addEventListener('touchmove', function(e) {
      if (document.getElementById('arContainer').style.display === 'block') {
        e.preventDefault();
      }
    }, { passive: false });
    
    // é˜²æ­¢é¡µé¢æ»šåŠ¨
    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';
  </script>
</body>
</html>
